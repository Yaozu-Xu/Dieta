# Automatically generated on 2021-03-06 UTC from https://codemagic.io/app/5fd8cc0777de1aadbae36182/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  staging-workflow:
    name: Staging Workflow
    max_build_duration: 60
    environment:
      vars:
        FIREBASE_IOS: Encrypted(Z0FBQUFBQmYyU25MeWdDZi1FREZDbVdGOWtsUDFSY1JiWGhLWHdTeW1NM3VCU0RtMXc0M3dYM3ROSDlVNDZqVFBPWENUdFN0QmprODBDVVA1Y3FfZmpjR3FZY2oybnQ0cGZPOUxvZDZBNExYdHhIYU9BTXBOU1FTVTkyenhrb3JtbUowN3lmWDlTaUtqU3VRMzkxX0xNRkRqWXRKRnR6cFotT0pGV1hlSzdoWXFNUlE2RmJPd2F3dTJWLVJmbnRwRFZ1VGg5UXNQYlFxa2pWX1plYmg5bmg2SWZxWXZsUmhCbGZMTFhjNnY4bEpuZU9GbW1KbFJuOTdyUW5QcWE3TE11anlnZlA0RHlWZEZvWWliYU1CQUpOOUdGSnltb1hPLXk4OXBDajlNc0xDOVlCMlNXeUg2QXAybDFVbXByNTlkM244bkxzQ18xbmFYeTZzVUNJZVlMdXZGQWNpaVQ1QU5oR3M5OVlwZWJxUW1JTzR6ZWhva0l5VGt5OElybkdvVzNJeTJnWGFTN2lJSmdBd3VrNTRnNWNyRzZVWDdrd25RS0tCUTF5ZXlpZnlFVmEtdjk5QnZDc1dZRll6bkJ5VUdzQXpkNFg2OUdVVkZxTHZmaUo3eTVSREtSM08zX1VEWWR4eWRScWo0Y2Y2aDlTUEctYl9VUEFwa2N2NlpsSXFkM0E5RHNNdVhULVJTLXZYQmc0YjB0bGVISkRhXzJjaGR6R0YyeDZDdW1oOTc3UUNNWGhFTmpWWjFaMXZFY3p5TkdjRFFOQ1ZaRTdvU1FyR25sek1kS2VRRWpBd1ZhakJwUks2Sm9JdnZHZEJmVEprekhVUTFUOWRYVjF0OGVTSU9fM21xRlhYUXdCWVpyd3hzZm1qaUZ2clpOYWdaVmxRUEJuY3FQcF8zTmFuTFllaGhkUEVUUXhhRG5yS201Vm02NVhOaXBUMUsxa1lkeF9jbURMWkVEcHFoMDhDdVNBbjNLMnQtcFVjWHZkbl9kbkNJWXNMSzBNVUkzMzVrUnlHNTQ4WmhDQXNGblcyU3JTZEthN2ZIM2ZJdlBSLUE3NEN0ZFBlZGxfMTlnTmpvRWlMWUM1QkR1SG03Vmc3Vm03bHY1MTV6VVlZRkM3SG80RmRkTThIODF6YVhkbFk3SExOUGNSNHV3NHV4cVBhYXFOQ0NhdTdqa2dXTTdpc0dQVlI5WWlTSWp4b25TdkZKTXktVEFGdlN6UEl3d2RwOVVTVlAzcG5Ub1gxWHhzb1RWZHVrSTFhbkttRXNXUkUtVGFvcVozWjcwYWt0a0ZTTDMwMDEwSEVSTG4zOGV1OFpIVTI3QllGeHQwOW1BdVFNeVhQTThjZDNHRTY2eTdOZmt3ODVRanRtZHJSSUpXYVBaX20zazJBa1FxNGpudGxHU0xocExacGk5STZEQXItRm1Mb2RCLTZueFpTNFdvNEI0MGRGY2Q0QzZFTTNKVFgxTy1SN0liRHdlZmM1dy1PeFIwclBYZ1llNnN6Q19uYVFaVWpLU2ZwUzBhY0ZpeElPbDZ0RU0ta0NyZWY3dnhJVElrQXN5RGdYY3hfcG5sNzFSSkVteWlWcFFKb3pETXBpYUh3R1k0dDhyQU8tNUNGZ0c4MTdDdnk1c2p5d3ZzNXQxSm51UGpmOS1MNXQ0SnlkWWNTNUQ5anBPb0d3ZjFFYVkxRmF3QnJUWXIwNjJONFNHbG5peVBQbndybEc5cmhQS1B4Sm16XzR3YmRZa1prOUZsUFFLcC1RaFhaR3RJaGhsdzhTbGxDcDh2dmN0TENrQWtXeVIwdEJ5Wi15X1U3MmkycVVxLS1zVk5zTUwwdGR6UjJlS3o2Y0JyV1lpUDBNQ1Q1Z2tJRzBXc2NFYmpaaWxlWEFVa09RV2NfYWxXZ2VBcndvYVB2eEpqaFNXM3F1NG5TRXVYX3BOUFZZVFNEWFgzMEIwY3BBZlR3a1d4b1o0V1FiQlBEdE1IYlNjSmgxT2pGZ2RKcVJtckVBQkdIQjVJdjUwZHphRDhmOS1Dck53YTRsRjQyX2U0cElkT3U3Uzc2Zk9nRHZfdFVRUkZSVWFfNnR1aFdNaDJQdDlSYllEbE01MUJHUG56ZFY2dTFPQXNENXZQNkMzNVA2ZGhfX05FTG5OMWJGREZuN0x1ZnVSMTBSd1NsRVRiMHJiS2hsOGV1bVU5cFA5WWRndkRHQTN5X1NFT21QTndkMWNucnhoQ2dJLWJ2UTlPSERaaDdYbGJqR1ZaZTU2WkJKbWtvQ0wyUk4tdXFYZXZUUzJ1TW5Xa0w1ZGkxWTFYVTVIX2lGR1Q4cHc2SExwc3phZGFmcGdPWkJnVFY1WXJpdUhzRUJSOENXeGNuTzRzUXdIT3pqNXAtMTRiVkFWMmJNSzBselE3dmtXNVEweGluMjVvOGt6QzFJTU9GdWk1bFh2aE5kM2ZxNDVRZ0h3bjVEWV9zYzZxU1o3bFlEZHBKMWtwR01CT2xUTEhRaF9EaG9JV0xwOTMtUDBlLWY0LUNOaFJqNnQyVHRSWE41dG0wTDBQNEpIbjQtVk5FUXo1clhRNXJpVWJFN09XVER2S3FOZEhVTnJnVlFicXFLMmxtaDU0SXdBRTk3QWFONnA2X2pzbkduZzRNNnE2ckpEZTZvaU1zYzlxZWk3ZmdrV053Y25JOWxIQURkUlY2emZDOHEwRWs2d2g5QnJ3U2NHTldheFA5QWhacjlDUWJjeGxQX1lmcmZ5NzA3Vkd1UWM5a3AxcVdBQmFmYzF4bnhFYmIwTlhoLXZid2xmY3JXSlB6anNkZ2c5aEt6QVhhOUtYOHFiRk9DUWZ3X29XY0pGdHRNTThvZ1owaHg0cHBXSV9OU2Q2V0E5bVJ1VmFmVmhqUzZLRW5kZWJHSU5XQU5IN2dpS3FmamE1SUhEUVY0cFBtYkhfZw==)
        ANDROID_FIREBASE_CONFIG: |-
          ewogICJwcm9qZWN0X2luZm8iOiB7CiAgICAicHJvamVjdF9udW1iZXIiOiAiMjU0NTAwODQwMzU2IiwKICAgICJmaXJlYmFzZV91cmwiOiAiaHR0cHM6Ly9kZWl0YS00NjRmOS5maXJlYmFzZWlvLmNvbSIsCiAgICAicHJvamVjdF9pZCI6ICJkZWl0YS00NjRmOSIsCiAgICAic3RvcmFnZV9idWNrZXQiOiAiZGVpdGEtNDY0ZjkuYXBwc3BvdC5jb20iCiAgfSwKICAiY2xpZW50IjogWwogICAgewogICAgICAiY2xpZW50X2luZm8iOiB7CiAgICAgICAgIm1vYmlsZXNka19hcHBfaWQiOiAiMToyNTQ1MDA4NDAzNTY6YW5kcm9pZDpkOGVjZDIwMmZmNjVmMGZmZmU5NzMxIiwKICAgICAgICAiYW5kcm9pZF9jbGllbnRfaW5mbyI6IHsKICAgICAgICAgICJwYWNrYWdlX25hbWUiOiAiY29tLmV4YW1wbGUuRGlldGEiCiAgICAgICAgfQogICAgICB9LAogICAgICAib2F1dGhfY2xpZW50IjogWwogICAgICAgIHsKICAgICAgICAgICJjbGllbnRfaWQiOiAiMjU0NTAwODQwMzU2LTMxMW9kODU0N2Q3dnY5NmJvOWxucGozYWxjYzk1aTlnLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwKICAgICAgICAgICJjbGllbnRfdHlw
          ZSI6IDMKICAgICAgICB9CiAgICAgIF0sCiAgICAgICJhcGlfa2V5IjogWwogICAgICAgIHsKICAgICAgICAgICJjdXJyZW50X2tleSI6ICJBSXphU3lDR01PUV92M3BQOVNINHJ6NEszQ1BMaVQ5QkljNFpTVVkiCiAgICAgICAgfQogICAgICBdLAogICAgICAic2VydmljZXMiOiB7CiAgICAgICAgImFwcGludml0ZV9zZXJ2aWNlIjogewogICAgICAgICAgIm90aGVyX3BsYXRmb3JtX29hdXRoX2NsaWVudCI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICJjbGllbnRfaWQiOiAiMjU0NTAwODQwMzU2LTMxMW9kODU0N2Q3dnY5NmJvOWxucGozYWxjYzk1aTlnLmFwcHMuZ29vZ2xldXNl
          cmNvbnRlbnQuY29tIiwKICAgICAgICAgICAgICAiY2xpZW50X3R5cGUiOiAzCiAgICAgICAgICAgIH0KICAgICAgICAgIF0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICBdLAogICJjb25maWd1cmF0aW9uX3ZlcnNpb24iOiAiMSIKfQ==
      flutter: stable
      xcode: latest
      cocoapods: default
    cache:
      cache_paths:
        - $HOME/Library/Caches/CocoaPods
        - $HOME/.gradle/caches
    triggering:
      events:
        - push
        - pull_request
      branch_patterns:
        - pattern: '*'
          include: true
          source: true
    scripts:
      - |
        # set up debug keystore
        rm -f ~/.android/debug.keystore
        keytool -genkeypair \
          -alias androiddebugkey \
          -keypass android \
          -keystore ~/.android/debug.keystore \
          -storepass android \
          -dname 'CN=Android Debug,O=Android,C=US' \
          -keyalg 'RSA' \
          -keysize 2048 \
          -validity 10000
      - |
        # set up local properties
        echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
      - cd . && flutter packages pub get
      - cd . && flutter analyze
      - cd . && flutter test
      - "echo $FIREBASE_IOS | base64 --decode > $FCI_BUILD_DIR/ios/Runner/GoogleService-Info.plist\n\
        \  \necho \"\\nListing iOS Directory to confirm the GoogleService-Info.plist\
        \ is there! \"\nls ios/Runner/\n\necho $ANDROID_FIREBASE_CONFIG | base64 --decode\
        \ > $FCI_BUILD_DIR/android/app/google-services.json\n\necho Decoded google-services.json!\
        \ Here is the directory after.\nls $FCI_BUILD_DIR/android/app\n"
      - cd . && flutter build apk --debug
      - find . -name "Podfile" -execdir pod install \;
      - cd . && flutter build ios --debug --no-codesign
    artifacts:
      - build/**/outputs/**/*.apk
      - build/**/outputs/**/*.aab
      - build/**/outputs/**/mapping.txt
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - 2589231996@qq.com
